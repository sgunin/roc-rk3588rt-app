<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- Generated by Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home&#160;Page</span></a></li>
      <li><a href="_xE5_x8F_x91_xE7_x89_x88_xE8_xAF_xB4_xE6_x98_x8E.html"><span>Release&#160;Notes</span></a></li>
      <li><a href="_xE7_x8E_xAF_xE5_xA2_x83_xE9_x85_x8D_xE7_xBD_xAE.html"><span>Environment&#160;Configuration</span></a></li>
      <li><a href="_xE7_xBC_x96_xE7_xA8_x8B_xE5_xBC_x95_xE5_xAF_xBC.html"><span>Programming&#160;Guide</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="_xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE8_x8A_x82_xE7_x82_xB9_xE8_xA1_xA8.html"><span>Camera&#160;Parameter&#160;Node&#160;Table</span></a></li>
      <li><a href="_xE7_xA4_xBA_xE4_xBE_x8B_xE7_xA8_x8B_xE5_xBA_x8F_xE6_xA6_x82_xE8_xA7_x88.html"><span>Sample&#160;Program&#160;Overview</span></a></li>
      <li><a href="_xE5_xB8_xB8_xE8_xA7_x81_xE9_x97_xAE_xE9_xA2_x98.html"><span>FAQs</span></a></li>
      <li><a href="_xE6_xB3_x95_xE5_xBE_x8B_xE5_xA3_xB0_xE6_x98_x8E.html"><span>Disclaimer</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><div class="header" style="margin-left:-12px;margin-top:-10px;margin-right:-8px;"> <div class="headertitle"> <div class="title">Image Acquisition</div> </div> </div> <div id="shortdesc"> <br />
 </div><div id="shortdesc">The SDK supports the following 2 image acquisition methods: callback and polling. Select one as needed.</div><div id="shortdesc"> <ul>
<li>
<a href="#callback">Callback</a>: Acquire image via callback. </li>
<li>
<a href="#sequencer">Polling</a>: Acquire image via polling. </li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>These two methods cannot be used at the same time. Select one at one time.</dd></dl>
<br />
 </div><div> <div id="callback"> <div class="mainparams"> <h2>Acquire Images via Callback</h2>
</div></div></div><div><div id="callback"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="callback"><div class="subparamswhite">The SDK provides an API to register callback function. You can call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga48d1c4ef073e39622fa01994a8fe010c" title="Register an image data callback, supporting getting chunk information.">MV_CC_RegisterImageCallBackEx()</a> and register callback API for image acquisition in SDK. After getting image, SDK will call custom callback function.</div></div></div><div><div id="callback"><div class="subparamswhite"> <dl class="section attention"><dt>Attention</dt><dd><ul>
<li>
Time-consuming operation and thread lock are not recommended, as adding them may block callback.  </li>
<li>
pUser is invalid and cannot be used again after callback ends.  </li>
</ul>
</dd></dl>
</div></div></div><div><div id="callback"><div class="subparamswhite">The API calling flow is as follows:</div></div></div><div><div id="callback"><div class="subparamswhite"> <ol>
<li>
Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga2088ec54d617eb629412729e0241067d" title="Set the number of SDK internal image buffer nodes (no less than 1). It should be called before callin...">MV_CC_SetImageNodeNum()</a> to set the appropriate number of buffer nodes. <dl class="section note"><dt>Note</dt><dd>Set the appropriate number of buffer nodes as needed. Major factors include: camera frame rate, image solution, computer disposition such as main board performance and memory.</dd></dl>
</li>
<li>
Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga48d1c4ef073e39622fa01994a8fe010c" title="Register an image data callback, supporting getting chunk information.">MV_CC_RegisterImageCallBackEx()</a> to register image processing function. </li>
<li>
Call::MV_CC_StartGrabbing() to start grabbing image. </li>
<li>
It will be executed and handle images in custom image processing function after SDK receives image. </li>
</ol>
</div></div></div><div><div id="callback"><div class="subparamswhite">The following sample code shows how to acquire image through callback function: <ul>
<li>
<p class="startli"></p>
<p class="interli">Method of customizing image callback:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> __stdcall ImageCallBackEx(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * pData, <a class="code" href="struct_m_v___f_r_a_m_e___o_u_t___i_n_f_o___e_x.html">MV_FRAME_OUT_INFO_EX</a>* pFrameInfo, <span class="keywordtype">void</span>* pUser)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (pFrameInfo)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;Get One Frame: Width[%d], Height[%d], FrameLen[%I64d] nFrameNum[%d]\n&quot;</span>, </div><div class="line">        pFrameInfo-&gt;<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#gad8e3c34af41bf74a4628b8a456b37a77">nExtendWidth</a>, pFrameInfo-&gt;<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga7b663309abd055da59e6e496b1092985">nExtendHeight</a>, pFrameInfo-&gt;<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga733999b9d4f3d252eb79df06f517b410">nFrameLenEx</a>,pFrameInfo-&gt;<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga6f8d00948b2d76ac8cd65fda0acc2ed6">nFrameNum</a>);</div><div class="line">        <span class="comment">// pData: an image pointer; pFrameInfo-&gt;nFrameLenEx: image length that can process image</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">Register a callback for image grabbing, and start acquiring images.</p>
<div class="fragment"><div class="line"><span class="comment">// Register image capture and callback</span></div><div class="line">nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga48d1c4ef073e39622fa01994a8fe010c">MV_CC_RegisterImageCallBackEx</a>(handle, ImageCallBackEx, handle);</div><div class="line">Check(nRet);</div><div class="line"></div><div class="line"><span class="comment">// Set the number of output buffer</span></div><div class="line">nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga2088ec54d617eb629412729e0241067d">MV_CC_SetImageNodeNum</a>(handle, 5);</div><div class="line">Check(nRet);</div><div class="line"></div><div class="line"><span class="comment">// Start grabbing images</span></div><div class="line">nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga78728211c47c6f118110fde635d6ac69">MV_CC_StartGrabbing</a>(handle);</div><div class="line">Check(nRet);</div></div><!-- fragment -->  </li>
</ul>
</div></div></div><div><div id="callback"><div class="subparamswhite"> </div> </div> <div id="sequencer"> <div class="mainparams"> <h2>Acquire Images via Polling</h2>
</div></div></div><div><div id="sequencer"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="sequencer"><div class="subparamswhite">SDK offers API for active image acquisition. You can manually create a thread, and repeatedly call this API in the thread to get image information.</div></div></div><div><div id="sequencer"><div class="subparamswhite"> </div></div></div><div><div id="sequencer"><div class="subparamswhite">Basic steps of acquiring image via polling are as follows:</div></div></div><div><div id="sequencer"><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga2088ec54d617eb629412729e0241067d" title="Set the number of SDK internal image buffer nodes (no less than 1). It should be called before callin...">MV_CC_SetImageNodeNum()</a> to set the appropriate number of buffer nodes in SDK. </p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>
Image data of camera received by SDK is cached in SDK for calling from users. Call :: <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga2088ec54d617eb629412729e0241067d" title="Set the number of SDK internal image buffer nodes (no less than 1). It should be called before callin...">MV_CC_SetImageNodeNum()</a> to configure number of buffer nodes in SDK. Due to slow calling of the upper layer, and limited buffer nodes, SDK memory is inadequate for storage of images sent from the camera, leading to frame loss. </li>
<li>
The actual number of buffer nodes depends on the actual situation (main factors including camera frame rate, image solution, computer disposition such as main board performance and memory). </li>
</ul>
</dd></dl>
</li>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga78728211c47c6f118110fde635d6ac69" title="Start grabbing images.">MV_CC_StartGrabbing()</a> to start grabbing image.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga33331585a4e2a64653b74af66157a6d8" title="Get one frame of picture using internal buffer.">MV_CC_GetImageBuffer()</a> in the application layer to get frame data in the specified pixel format.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>
You can set the timeout of this API. SDK waits for returned data before timeout. </li>
<li>
When getting image data, you can configure API calling frequency in the upper application layer according to the camera frame rate. </li>
</ul>
</dd></dl>
</li>
<li>
Process image through buffer operation. </li>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gaeff416b2d35df148fa2e63521d8847d3" title="Release image buffer. This API is used to release the image buffer which is no longer used,...">MV_CC_FreeImageBuffer()</a> to release buffer.</p>
<dl class="section note"><dt>Note</dt><dd>Buffer will be returned to SDK when calling <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gaeff416b2d35df148fa2e63521d8847d3" title="Release image buffer. This API is used to release the image buffer which is no longer used,...">MV_CC_FreeImageBuffer()</a>. Buffer will be invalid after being returned.  </dd></dl>
</li>
</ol>
</div></div></div><div><div id="sequencer"><div class="subparamswhite"> </div></div></div><div><div id="sequencer"><div class="subparamswhite">The following sample code shows the process of acquiring images via polling:</div></div></div><div><div id="sequencer"><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli">Customize the thread function, and receive and process images.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> __stdcall WorkThread(<span class="keywordtype">void</span>* handle)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> nRet = <a class="code" href="group___xE6_xAD_xA3_xE7_xA1_xAE_xE7_xA0_x81.html#gacc4f15d534603b339f751d8b2d569305">MV_OK</a>;</div><div class="line">    <a class="code" href="struct_m_v___f_r_a_m_e___o_u_t.html">MV_FRAME_OUT</a> stOutFrame = {0};</div><div class="line">    <span class="keywordflow">while</span>(<span class="keyword">true</span>)</div><div class="line">    {</div><div class="line">        nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga33331585a4e2a64653b74af66157a6d8">MV_CC_GetImageBuffer</a>(handle, &amp;stOutFrame, 1000);</div><div class="line">        <span class="keywordflow">if</span> (nRet == <a class="code" href="group___xE6_xAD_xA3_xE7_xA1_xAE_xE7_xA0_x81.html#gacc4f15d534603b339f751d8b2d569305">MV_OK</a>)</div><div class="line">        {</div><div class="line">            printf(<span class="stringliteral">&quot;Get Image Buffer: Width[%d], Height[%d], FrameNum[%d]\n&quot;</span>,</div><div class="line">            stOutFrame.<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga2587481f4ebfe4e2dcc78f073978772a">stFrameInfo</a>.<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga523c75b72da2a3bb32b97032f86c4703">nWidth</a>, stOutFrame.<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga2587481f4ebfe4e2dcc78f073978772a">stFrameInfo</a>.<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga33071a62b54a3c9a671a0fcbe4804f1a">nHeight</a>, stOutFrame.<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga2587481f4ebfe4e2dcc78f073978772a">stFrameInfo</a>.<a class="code" href="group___xE7_xBB_x93_xE6_x9E_x84_xE4_xBD_x93_xE5_xAE_x9A_xE4_xB9_x89.html#ga6f8d00948b2d76ac8cd65fda0acc2ed6">nFrameNum</a>);</div><div class="line">            nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gaeff416b2d35df148fa2e63521d8847d3">MV_CC_FreeImageBuffer</a>(handle, &amp;stOutFrame);</div><div class="line">            Check(nRet);</div><div class="line"></div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(g_bExit)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">Start to collect</p>
<div class="fragment"><div class="line"><span class="comment">// Set number of buffer nodes</span></div><div class="line">nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga2088ec54d617eb629412729e0241067d">MV_CC_SetImageNodeNum</a>(handle, 5);</div><div class="line">Check(nRet);</div><div class="line"></div><div class="line"><span class="comment">// Start grabbing images</span></div><div class="line">nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga78728211c47c6f118110fde635d6ac69">MV_CC_StartGrabbing</a>(handle);</div><div class="line">Check(nRet);</div><div class="line"></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nThreadID = 0;</div><div class="line"><span class="keywordtype">void</span>* hThreadHandle = (<span class="keywordtype">void</span>*) _beginthreadex(NULL , 0 , WorkThread , handle, 0 , &amp;nThreadID );</div><div class="line"><span class="keywordflow">if</span> (NULL == hThreadHandle)</div><div class="line">{</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment -->  </li>
</ol>
</div></div></div><div><div id="sequencer"><div class="subparamswhite"> </div> </div></div><div> <div> <br />
 <br />
 <br />
 <table width="60%">
<tr>
<td>Previous: <a class="el" href="_xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html">Event and Exception</a> </td><td>Next: <a class="el" href="_xE5_xA4_x84_xE7_x90_x86_xE5_x9B_xBE_xE5_x83_x8F.html">Image Processing</a>  </td></tr>
</table>
</div> </div> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
</body>
</html>